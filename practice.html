<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L√†m B√†i T·∫≠p - H·ªçc To√°n Vui</title>
    <meta name="description" content="L√†m b√†i t·∫≠p to√°n h·ªçc cho tr·∫ª 5 tu·ªïi">
    <link rel="stylesheet" href="styles.css">
    <style>
        .practice-container {
            max-width: 900px;
            margin: 0 auto;
            padding: var(--spacing-2xl);
        }

        .student-section {
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            padding: var(--spacing-2xl);
            border-radius: var(--radius-xl);
            color: white;
            margin-bottom: var(--spacing-2xl);
            text-align: center;
        }

        .exercise-card {
            background: white;
            padding: var(--spacing-2xl);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            margin-bottom: var(--spacing-xl);
        }

        .exercise-question {
            font-size: var(--font-size-2xl);
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: var(--spacing-xl);
            text-align: center;
            line-height: 1.6;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-md);
            margin: var(--spacing-xl) 0;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .option-btn {
            padding: var(--spacing-lg);
            font-size: var(--font-size-lg);
            border: 3px solid var(--color-primary);
            background: white;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .option-btn:hover {
            background: var(--color-primary);
            color: white;
            transform: scale(1.05);
        }

        .option-btn.correct {
            background: var(--color-accent-green);
            color: white;
            border-color: var(--color-accent-green);
        }

        .option-btn.incorrect {
            background: #ef4444;
            color: white;
            border-color: #ef4444;
        }

        .answer-input {
            width: 100%;
            max-width: 300px;
            padding: var(--spacing-lg);
            font-size: var(--font-size-2xl);
            border: 3px solid var(--color-primary);
            border-radius: var(--radius-lg);
            text-align: center;
            font-weight: 600;
            margin: 0 auto;
            display: block;
        }

        .feedback {
            text-align: center;
            padding: var(--spacing-lg);
            border-radius: var(--radius-lg);
            margin: var(--spacing-lg) 0;
            font-size: var(--font-size-lg);
            font-weight: 600;
        }

        .feedback.correct {
            background: var(--color-accent-green);
            color: white;
        }

        .feedback.incorrect {
            background: #ef4444;
            color: white;
        }

        .progress-bar {
            background: var(--color-bg-secondary);
            height: 30px;
            border-radius: var(--radius-full);
            overflow: hidden;
            margin: var(--spacing-lg) 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--color-primary), var(--color-secondary));
            height: 100%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-md);
            margin: var(--spacing-xl) 0;
        }

        .stat-card {
            background: var(--color-bg-secondary);
            padding: var(--spacing-lg);
            border-radius: var(--radius-lg);
            text-align: center;
        }

        .stat-number {
            font-size: var(--font-size-3xl);
            font-weight: 700;
            color: var(--color-primary);
        }

        .stat-label {
            color: var(--color-text-secondary);
            margin-top: var(--spacing-sm);
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="logo">üéì H·ªçc To√°n Vui</a>
            <button class="nav-toggle" id="navToggle">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul class="nav-links" id="navLinks">
                <li><a href="index.html">Trang Ch·ªß</a></li>
                <li><a href="curriculum.html">Ch∆∞∆°ng Tr√¨nh H·ªçc</a></li>
                <li><a href="practice.html" class="active">L√†m B√†i T·∫≠p</a></li>
            </ul>
        </div>
    </nav>

    <div class="practice-container">
        <!-- Student Registration -->
        <div id="studentSection" class="student-section">
            <h1>üëã Ch√†o B√©!</h1>
            <p style="font-size: var(--font-size-lg); margin: var(--spacing-md) 0;">
                H√£y cho b√© bi·∫øt t√™n ƒë·ªÉ b·∫Øt ƒë·∫ßu l√†m b√†i t·∫≠p nh√©!
            </p>
            <div style="margin-top: var(--spacing-xl);">
                <input type="text" id="studentName" placeholder="Nh·∫≠p t√™n b√©..."
                    style="padding: var(--spacing-md) var(--spacing-lg); font-size: var(--font-size-lg); border-radius: var(--radius-lg); border: none; width: 100%; max-width: 400px; text-align: center;">
                <button onclick="registerStudent()" class="btn btn-primary"
                    style="margin-top: var(--spacing-md); background: white; color: var(--color-primary);">
                    B·∫Øt ƒê·∫ßu L√†m B√†i üöÄ
                </button>
            </div>
        </div>

        <!-- Module Selection -->
        <div id="moduleSection" class="hidden">
            <h2 class="text-center mb-xl">Ch·ªçn Ch∆∞∆°ng Tr√¨nh H·ªçc</h2>
            <div class="grid grid-2">
                <div class="card" onclick="selectModule(1)" style="cursor: pointer;">
                    <h3>üî¢ Module 1</h3>
                    <p>Nh·∫≠n Bi·∫øt S·ªë 0-10</p>
                    <div class="btn btn-primary" style="margin-top: var(--spacing-md);">B·∫Øt ƒê·∫ßu</div>
                </div>
                <div class="card" onclick="selectModule(2)" style="cursor: pointer;">
                    <h3>üìä Module 2</h3>
                    <p>ƒê·∫øm v√† So S√°nh</p>
                    <div class="btn btn-primary" style="margin-top: var(--spacing-md);">B·∫Øt ƒê·∫ßu</div>
                </div>
                <div class="card" onclick="selectModule(3)" style="cursor: pointer;">
                    <h3>‚ûï Module 3</h3>
                    <p>C·ªông Tr·ª´ C∆° B·∫£n</p>
                    <div class="btn btn-primary" style="margin-top: var(--spacing-md);">B·∫Øt ƒê·∫ßu</div>
                </div>
                <div class="card" onclick="selectModule(4)" style="cursor: pointer;">
                    <h3>üî∫ Module 4</h3>
                    <p>H√¨nh H·ªçc v√† Logic</p>
                    <div class="btn btn-primary" style="margin-top: var(--spacing-md);">B·∫Øt ƒê·∫ßu</div>
                </div>
            </div>
        </div>

        <!-- Exercise Section -->
        <div id="exerciseSection" class="hidden">
            <!-- Stats -->
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="correctCount">0</div>
                    <div class="stat-label">ƒê√∫ng</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalCount">0</div>
                    <div class="stat-label">T·ªïng s·ªë</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="percentageCount">0%</div>
                    <div class="stat-label">T·ª∑ l·ªá</div>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar" style="width: 0%;">0/100</div>
            </div>

            <!-- Exercise Card -->
            <div class="exercise-card">
                <!-- Visual Illustration Area -->
                <div id="visualArea"
                    style="text-align: center; margin-bottom: var(--spacing-2xl); min-height: 120px; display: flex; align-items: center; justify-content: center; font-size: 5rem; line-height: 1.2; flex-wrap: wrap; gap: 15px; padding: var(--spacing-lg); background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: var(--radius-lg);">
                </div>

                <div class="exercise-question" id="questionText"></div>

                <!-- Multiple Choice Options -->
                <div id="optionsContainer" class="options-grid hidden"></div>

                <!-- Text Input -->
                <div id="inputContainer" class="hidden">
                    <input type="text" id="answerInput" class="answer-input" placeholder="Nh·∫≠p ƒë√°p √°n...">
                    <button onclick="submitAnswer()" class="btn btn-primary"
                        style="margin-top: var(--spacing-lg); display: block; margin-left: auto; margin-right: auto;">
                        Ki·ªÉm Tra
                    </button>
                </div>

                <!-- Feedback -->
                <div id="feedback" class="feedback hidden"></div>

                <!-- Next Button -->
                <div id="nextBtnContainer" class="hidden" style="text-align: center; margin-top: var(--spacing-lg);">
                    <button onclick="nextExercise()" class="btn btn-primary">
                        B√†i Ti·∫øp Theo ‚Üí
                    </button>
                </div>
            </div>

            <div style="text-align: center; margin-top: var(--spacing-xl);">
                <button onclick="backToModules()" class="btn btn-outline">
                    ‚Üê Ch·ªçn Module Kh√°c
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 H·ªçc To√°n Vui - Design by BynByn</p>
        </div>
    </footer>

    <script src="api-client.js"></script>
    <script src="script.js"></script>
    <script>
        let currentStudent = null;
        let currentModule = null;
        let exercises = [];
        let currentExerciseIndex = 0;
        let correctAnswers = 0;
        let totalAnswered = 0;

        // Register student
        async function registerStudent() {
            const nameInput = document.getElementById('studentName');
            const name = nameInput.value.trim();

            if (!name) {
                alert('Vui l√≤ng nh·∫≠p t√™n b√©!');
                return;
            }

            try {
                // Create or get student
                const student = await API.createStudent(name);
                currentStudent = student;
                StudentManager.setCurrentStudentId(student.id);
                StudentManager.setCurrentStudentName(name);

                // Show module selection
                document.getElementById('studentSection').classList.add('hidden');
                document.getElementById('moduleSection').classList.remove('hidden');
            } catch (error) {
                console.error('Error registering student:', error);
                alert('Kh√¥ng th·ªÉ t·∫°o h·ªçc sinh. Vui l√≤ng ki·ªÉm tra server ƒëang ch·∫°y!');
            }
        }

        // Shuffle array function (Fisher-Yates algorithm)
        function shuffleArray(array) {
            const shuffled = [...array]; // Create a copy
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Select module
        async function selectModule(moduleNum) {
            currentModule = moduleNum;

            try {
                // Load exercises
                const loadedExercises = await API.getExercises(moduleNum);

                // Shuffle exercises for randomization
                exercises = shuffleArray(loadedExercises);

                currentExerciseIndex = 0;
                correctAnswers = 0;
                totalAnswered = 0;

                // Show exercise section
                document.getElementById('moduleSection').classList.add('hidden');
                document.getElementById('exerciseSection').classList.remove('hidden');

                // Load first exercise
                loadExercise();
                updateStats();
            } catch (error) {
                console.error('Error loading exercises:', error);
                alert('Kh√¥ng th·ªÉ t·∫£i b√†i t·∫≠p. Vui l√≤ng ki·ªÉm tra server!');
            }
        }

        // Generate visual illustration for question
        function generateVisualIllustration(question, category) {
            const visualArea = document.getElementById('visualArea');

            // Parse math equations (addition/subtraction)
            const mathMatch = question.match(/(\d+)\s*([+\-])\s*(\d+)\s*=\s*\?/);

            if (mathMatch) {
                const num1 = parseInt(mathMatch[1]);
                const operator = mathMatch[2];
                const num2 = parseInt(mathMatch[3]);

                if (operator === '+') {
                    // Addition: show two groups of dots
                    return generateAdditionVisual(num1, num2);
                } else if (operator === '-') {
                    // Subtraction: show dots with some crossed out
                    return generateSubtractionVisual(num1, num2);
                }
            }

            // Parse number recognition questions
            const numberMatch = question.match(/s·ªë\s+(\d+)/i);
            if (numberMatch && (question.includes('l√† s·ªë') || question.includes('t∆∞∆°ng ·ª©ng'))) {
                const num = parseInt(numberMatch[1]);
                return generateNumberVisual(num);
            }

            // Parse sequence questions (ƒëi·ªÅn s·ªë thi·∫øu)
            if (question.includes('ƒêi·ªÅn s·ªë thi·∫øu') || question.includes('__')) {
                const numbers = question.match(/\d+/g);
                if (numbers) {
                    return generateSequenceVisual(numbers);
                }
            }

            // Parse "before/after" questions
            if (question.includes('ƒë·ª©ng tr∆∞·ªõc') || question.includes('ƒë·ª©ng sau') || question.includes('n·∫±m gi·ªØa')) {
                const numbers = question.match(/\d+/g);
                if (numbers) {
                    return generateSequenceVisual(numbers);
                }
            }

            // Parse word problems with visual cues
            if (question.includes('qu·∫£ t√°o') || question.includes('qu·∫£ cam')) {
                const numbers = question.match(/\d+/g);
                if (numbers) {
                    return generateFruitVisual(numbers[0], 'üçé');
                }
            }

            return null;
        }

        function generateAdditionVisual(num1, num2) {
            // Random emoji sets for variety
            const emojiSets = [
                ['üçé', 'üçä'],  // Apple + Orange
                ['üêõ', 'ü¶ã'],  // Caterpillar + Butterfly
                ['üç¨', 'üç≠'],  // Candy + Lollipop
                ['‚≠ê', 'üåü'],  // Stars
                ['üå∏', 'üå∫'],  // Flowers
                ['üêü', 'üê†'],  // Fish
                ['üçì', 'üçí'],  // Strawberry + Cherry
                ['üöó', 'üöô'],  // Cars
            ];

            const randomSet = emojiSets[Math.floor(Math.random() * emojiSets.length)];
            const emoji1 = randomSet[0];
            const emoji2 = randomSet[1];

            const items1 = Array(num1).fill(0).map(() =>
                `<span style="font-size: 3rem; margin: 5px; display: inline-block; animation: bounce 0.5s;">${emoji1}</span>`
            ).join('');

            const items2 = Array(num2).fill(0).map(() =>
                `<span style="font-size: 3rem; margin: 5px; display: inline-block; animation: bounce 0.5s;">${emoji2}</span>`
            ).join('');

            return `
                <style>
                    @keyframes bounce {
                        0%, 100% { transform: translateY(0); }
                        50% { transform: translateY(-10px); }
                    }
                </style>
                <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap; justify-content: center;">
                    <div style="display: flex; flex-wrap: wrap; max-width: 300px; padding: 15px; background: rgba(255, 107, 107, 0.1); border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">
                        ${items1}
                    </div>
                    <div style="font-size: 3rem; font-weight: bold; color: #667EEA;">+</div>
                    <div style="display: flex; flex-wrap: wrap; max-width: 300px; padding: 15px; background: rgba(78, 205, 196, 0.1); border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">
                        ${items2}
                    </div>
                    <div style="font-size: 3rem; font-weight: bold; color: #667EEA;">=</div>
                    <div style="font-size: 3rem; font-weight: bold; color: #667EEA;">?</div>
                </div>
            `;
        }

        function generateSubtractionVisual(num1, num2) {
            const result = num1 - num2;

            // Random emoji for subtraction
            const subEmojis = ['üçé', 'üçä', 'üç¨', 'üç≠', '‚≠ê', 'üå∏', 'üêü', 'üöó', 'üéà', 'üç™'];
            const emoji = subEmojis[Math.floor(Math.random() * subEmojis.length)];

            const items = Array(num1).fill(0).map((_, i) => {
                const isCrossed = i >= result;
                return `<span style="font-size: 3rem; margin: 5px; display: inline-block; position: relative; ${isCrossed ? 'opacity: 0.3; filter: grayscale(100%);' : ''}">
                    ${emoji}
                    ${isCrossed ? '<span style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 4rem; color: #ff0000;">‚úñ</span>' : ''}
                </span>`;
            }).join('');

            return `
                <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap; justify-content: center;">
                    <div style="display: flex; flex-wrap: wrap; max-width: 500px; padding: 15px; background: rgba(255, 107, 107, 0.1); border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">
                        ${items}
                    </div>
                    <div style="font-size: 1.5rem; color: #666; background: white; padding: 10px 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                        <div>B·ªè ƒëi ${num2} ${emoji}</div>
                        <div style="margin-top: 5px; color: #667EEA; font-weight: bold;">‚Üí C√≤n l·∫°i ?</div>
                    </div>
                </div>
            `;
        }

        function generateNumberVisual(number) {
            const colors = ['#667EEA', '#764BA2', '#F093FB', '#4FACFE'];
            return `
                <div style="display: flex; align-items: center; justify-content: center; gap: 30px;">
                    <div style="width: 200px; height: 200px; background: linear-gradient(135deg, ${colors[0]}, ${colors[1]}); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                        <span style="font-size: 8rem; font-weight: bold; color: white;">${number}</span>
                    </div>
                </div>
            `;
        }

        function generateSequenceVisual(numbers) {
            const items = numbers.slice(0, 5).map(num =>
                `<div style="width: 60px; height: 60px; background: linear-gradient(135deg, #667EEA, #764BA2); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">${num}</div>`
            ).join('');

            return `
                <div style="display: flex; gap: 15px; align-items: center; justify-content: center;">
                    ${items}
                </div>
            `;
        }

        function generateFruitVisual(count, emoji) {
            const fruits = Array(parseInt(count)).fill(emoji).map(e =>
                `<span style="font-size: 3rem; margin: 8px;">${e}</span>`
            ).join('');

            return `
                <div style="display: flex; flex-wrap: wrap; justify-content: center; max-width: 500px;">
                    ${fruits}
                </div>
            `;
        }

        // Load current exercise
        function loadExercise() {
            if (currentExerciseIndex >= exercises.length) {
                showCompletion();
                return;
            }

            const exercise = exercises[currentExerciseIndex];
            const questionText = exercise.question;
            const visualArea = document.getElementById('visualArea');

            // Generate dynamic illustration
            const dynamicVisual = generateVisualIllustration(questionText, exercise.category);

            if (dynamicVisual) {
                visualArea.innerHTML = dynamicVisual;
                visualArea.style.display = 'flex';
                document.getElementById('questionText').textContent = questionText;
            } else {
                // Fallback to emoji detection
                const emojiRegex = /[\u{1F300}-\u{1F9FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]|[‚≠ê‚≠ï‚¨úüî∫‚ñ≠]/gu;
                const emojis = questionText.match(emojiRegex);

                if (emojis && emojis.length > 0) {
                    visualArea.innerHTML = emojis.map(emoji => `<span style="margin: 5px; font-size: 4rem;">${emoji}</span>`).join('');
                    visualArea.style.display = 'flex';
                    const cleanQuestion = questionText.replace(emojiRegex, '').replace(/:\s+/g, ': ').replace(/\s+/g, ' ').trim();
                    document.getElementById('questionText').textContent = cleanQuestion;
                } else {
                    // Check for geometry questions
                    const lowerQuestion = questionText.toLowerCase();
                    const geometryMap = {
                        'tam gi√°c': 'üî∫',
                        'vu√¥ng': '‚¨ú',
                        'tr√≤n': '‚≠ï',
                        'ch·ªØ nh·∫≠t': '‚ñ≠'
                    };

                    let shapeEmoji = null;
                    for (const [keyword, emoji] of Object.entries(geometryMap)) {
                        if (lowerQuestion.includes(keyword)) {
                            shapeEmoji = emoji;
                            break;
                        }
                    }

                    if (shapeEmoji) {
                        visualArea.innerHTML = `<span style="font-size: 8rem;">${shapeEmoji}</span>`;
                        visualArea.style.display = 'flex';
                        document.getElementById('questionText').textContent = questionText;
                    } else {
                        visualArea.style.display = 'none';
                        document.getElementById('questionText').textContent = questionText;
                    }
                }
            }

            document.getElementById('feedback').classList.add('hidden');
            document.getElementById('nextBtnContainer').classList.add('hidden');

            // Show appropriate input type
            if (exercise.options) {
                // Multiple choice
                showMultipleChoice(exercise.options);
            } else {
                // Text input
                showTextInput();
            }

            updateProgress();
        }

        // Show multiple choice options
        function showMultipleChoice(options) {
            document.getElementById('optionsContainer').classList.remove('hidden');
            document.getElementById('inputContainer').classList.add('hidden');

            const container = document.getElementById('optionsContainer');
            container.innerHTML = '';

            options.forEach(option => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option;
                btn.onclick = () => checkMultipleChoice(option, btn);
                container.appendChild(btn);
            });
        }

        // Show text input
        function showTextInput() {
            document.getElementById('optionsContainer').classList.add('hidden');
            document.getElementById('inputContainer').classList.remove('hidden');
            document.getElementById('answerInput').value = '';
            document.getElementById('answerInput').focus();
        }

        // Check multiple choice answer
        async function checkMultipleChoice(selected, btn) {
            const exercise = exercises[currentExerciseIndex];
            const isCorrect = selected === exercise.correctAnswer;

            // Disable all buttons
            document.querySelectorAll('.option-btn').forEach(b => {
                b.disabled = true;
                if (b.textContent === exercise.correctAnswer) {
                    b.classList.add('correct');
                }
            });

            if (!isCorrect) {
                btn.classList.add('incorrect');
            }

            await handleAnswer(selected, isCorrect);
        }

        // Submit text answer
        async function submitAnswer() {
            const answer = document.getElementById('answerInput').value.trim();

            if (!answer) {
                alert('Vui l√≤ng nh·∫≠p ƒë√°p √°n!');
                return;
            }

            const exercise = exercises[currentExerciseIndex];
            const isCorrect = answer === exercise.correctAnswer;

            await handleAnswer(answer, isCorrect);
        }

        // Handle answer submission
        async function handleAnswer(answer, isCorrect) {
            const exercise = exercises[currentExerciseIndex];

            // Save result to backend
            try {
                await API.saveResult(
                    currentStudent.id,
                    currentModule,
                    exercise.id,
                    answer,
                    isCorrect
                );
            } catch (error) {
                console.error('Error saving result:', error);
            }

            // Update stats
            totalAnswered++;
            if (isCorrect) {
                correctAnswers++;
            }
            updateStats();

            // Show feedback
            const feedback = document.getElementById('feedback');
            feedback.classList.remove('hidden');
            feedback.className = 'feedback ' + (isCorrect ? 'correct' : 'incorrect');
            feedback.textContent = isCorrect
                ? 'üéâ Ch√≠nh x√°c! Gi·ªèi l·∫Øm!'
                : `üòä Ch∆∞a ƒë√∫ng! ƒê√°p √°n l√†: ${exercise.correctAnswer}`;

            // Show next button
            document.getElementById('nextBtnContainer').classList.remove('hidden');
        }

        // Next exercise
        function nextExercise() {
            currentExerciseIndex++;
            loadExercise();
        }

        // Update progress
        function updateProgress() {
            const progress = Math.round((currentExerciseIndex / exercises.length) * 100);
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = progress + '%';
            progressBar.textContent = `${currentExerciseIndex}/${exercises.length}`;
        }

        // Update stats
        function updateStats() {
            document.getElementById('correctCount').textContent = correctAnswers;
            document.getElementById('totalCount').textContent = totalAnswered;
            const percentage = totalAnswered > 0
                ? Math.round((correctAnswers / totalAnswered) * 100)
                : 0;
            document.getElementById('percentageCount').textContent = percentage + '%';
        }

        // Show completion
        function showCompletion() {
            const percentage = Math.round((correctAnswers / totalAnswered) * 100);
            document.getElementById('exerciseSection').innerHTML = `
                <div class="card text-center">
                    <h2 style="font-size: var(--font-size-4xl); margin-bottom: var(--spacing-lg);">
                        üéâ Ho√†n Th√†nh Module ${currentModule}!
                    </h2>
                    <div style="font-size: var(--font-size-3xl); color: var(--color-primary); margin: var(--spacing-xl) 0;">
                        ${correctAnswers}/${totalAnswered} c√¢u ƒë√∫ng (${percentage}%)
                    </div>
                    <p style="font-size: var(--font-size-lg); margin: var(--spacing-lg) 0;">
                        ${percentage >= 80 ? 'Xu·∫•t s·∫Øc! B√© l√†m r·∫•t t·ªët! üåü' :
                    percentage >= 60 ? 'T·ªët l·∫Øm! B√© ƒëang ti·∫øn b·ªô! üëç' :
                        'C·ªë g·∫Øng th√™m nh√©! B√© s·∫Ω gi·ªèi h∆°n! üí™'}
                    </p>
                    <button onclick="backToModules()" class="btn btn-primary" style="margin-top: var(--spacing-xl);">
                        Ch·ªçn Module Kh√°c
                    </button>
                </div>
            `;
        }

        // Back to modules
        function backToModules() {
            document.getElementById('exerciseSection').classList.add('hidden');
            document.getElementById('moduleSection').classList.remove('hidden');
        }

        // Check if student already registered
        window.onload = function () {
            if (StudentManager.hasCurrentStudent()) {
                const name = StudentManager.getCurrentStudentName();
                const id = StudentManager.getCurrentStudentId();
                currentStudent = { id: parseInt(id), name: name };

                document.getElementById('studentSection').classList.add('hidden');
                document.getElementById('moduleSection').classList.remove('hidden');
            }
        };
    </script>
</body>

</html>